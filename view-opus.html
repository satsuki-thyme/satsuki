<html lang="ja" class="view-opus sub-page load-contents">
<title>作品閲覧ページ</title>
<meta charset="utf-8">
<meta name="keywords" content="五月タイム, 小説, ネット小説, ライトノベル, ラノベ">
<meta name="description" content="ネット小説を主に執筆している小説執筆活動家「五月タイム」の作品閲覧ページです。">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:url" content="https://satsuki-thyme.com/view-opus.html">
<meta property="og:title" content="作品閲覧ページ">
<meta property="og:description" content="ネット小説を主に執筆している小説執筆活動家「五月タイム」の作品閲覧ページです。">
<meta property="og:image" content="https://satsuki-thyme.com/images/og-image.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:site_name" content="五月タイムのサイト">
<meta property="og:type" content="webpage">
<meta property="og:locale" content="ja_JP">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@SatsukiThyme">
<meta name="twitter:site" content="@satsuki_thyme">
<meta name="twitter:image:src" content="https://satsuki-thyme.com/images/thyme-fg-white-bg-green-512s.png">
<meta property="article:publisher" content="https://www.facebook.com/satsuki.thyme">
<meta property="fb:admins" content="satsuki.thyme">
<meta name="application-name" content="Satsuki Thyme">
<meta name="msapplication-square70x70logo" content="https://satsuki-thyme.com/images/thyme-fg-white-bg-green-70s.png">
<meta name="msapplication-square150x150logo" content="https://satsuki-thyme.com/images/thyme-fg-white-bg-green-150s.png">
<meta name="msapplication-wide310x150logo" content="https://satsuki-thyme.com/images/thyme-fg-white-bg-green-310x150.png">
<meta name="msapplication-square310x310logo" content="https://satsuki-thyme.com/images/thyme-fg-white-bg-green-310s.png">
<meta name="msapplication-TileColor" content="#62a433">
<link rel="icon" href="https://satsuki-thyme.com/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="https://satsuki-thyme.com/images/thyme-fg-white-bg-green-180s.png">
<link href="/default.css" rel="stylesheet">
<style>
/*

  novel

*/
.novel main {
  font-family: 'Lucida Grande', sans-serif;
  font-size: 14px;
  background: #ffffff;
  color: #444444;
  word-break: normal !important;
  word-wrap: break-word;
  direction: ltr;
  unicode-bidi: bidi-override;
}
.novel main a {
  text-decoration: none;
  color: #0033cc;
  outline: none;
}
.novel main a:visited {
  color: #885577;
}
.novel main ruby {
  line-height: 39px;
}
.novel main .rt-none {
  display: none;
}
.novel .selected-len {
  display: none;
}
.novel .selected-len.appear {
  display: initial;
  position: fixed;
  top: 0;
  left: 0;
  padding: 10px;
  background-color: rgba(0, 0, 0, 0.05)
}
.novel .info {
  position: relative;
  padding-bottom: 10px;
  text-align: center;
  border-bottom: 1px solid #aaaaaa;
}
.novel .info::after {
  content: "";
  display: block;
  position: absolute;
  bottom: 0;
  width: 100%;
  height: 1px;
  background-color: #ececec;
}
.novel .info .title,
.novel .info .number {
  line-height: 1.15;
}
.novel .info .name {
  margin-right: 20px;
}
.novel .info .phrase {
  margin-right: 10px;
  margin-left:  10px;
}
.novel main #novel_contents {
  margin: 0;
  width: 100%;
  padding: 0 0 50px 0;
  text-align: left;
  line-height: 180%;
  clear: both;
  position: relative;
  top: 10px;
  left: 0;
}
.novel main #novel_color {
  color: #444444;
  font-family: "メイリオ", "Meiryo", 'Lucida Grande', "sans-serif";
  font-size: 16px;
  letter-spacing: 0.09em;
  margin: 0 auto;
  width: 100%;
  max-width: 700px;
}
.novel main .novel_bn {
  text-align: center;
}
.novel main .novel_bn a {
  font-size: 90%;
  margin: 0 10px;
}
.novel main #novel_no {
  margin: 0 10px 10px 0;
  text-align: right;
  color: #999999;
  font-size: 90%;
}
.novel main .novel_title,
.novel main .novel_subtitle {
  font-size: 170%;
  line-height: 150%;
}

.novel main .novel_title,
.novel main .novel_subtitle {
  margin: 0 auto 10px;
  text-align: center;
  font-size: 170%;
  font-weight: bold;
  line-height: 150%;
}
.novel main #novel_honbun {
  margin: 30px auto 50px;
  padding: 0 20px 0 20px;
  width: 100%;
  box-sizing: border-box;
  line-height: 28.8px;
  font-size: 16px;
}
.novel main #novel_honbun p {
  line-height: 28.8px;
}
.novel main #novel_honbun p + p {
  margin-top: 0;
}
.novel ruby {
  line-height: 1;
}
.novel tr {
  line-height: 1;
}
.novel a.prev,
.novel a.next {
  display: none;
}
.novel #area-counter-slctd {
  position: fixed;
  display: none;
  top: 0;
  left: 0;
  padding: 7px;
  background-color: rgba(0, 0, 0, 0.1);
}
.novel #area-counter-slctd.selected {
  display: block;
}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="/mdparse.js"></script>
<script src="/default.js"></script>
<script>
let search = location.search.slice(1)
let host = location.hostname
let stngObj = {
  "loadContent": {
    "satsuki-thyme.com": {
      "backHost": "raw.githubusercontent.com",
      "userName": "satsuki-thyme",
      "repoSite": "satsuki-thyme.github.io",
      "branch": "master",
      "dfltDoc": "README.md",
      "urlHome": "/novel.html",
      "urlBase": "/view-opus.html"
    },
    "satsuki-thyme.c": {
      "backHost": "novel.c",
      "userName": "",
      "repoSite": "",
      "branch": "",
      "dfltDoc": "README.md",
      "urlHome": "/novel.html",
      "urlBase": "/view-opus.html"
    },
    "novel.c": {
      "backHost": "novel.c",
      "userName": "",
      "repoSite": "",
      "branch": "",
      "dfltDoc": "README.md",
      "urlHome": "?README.md",
      "urlBase": "/view-opus.html"
    }
  }
}
let backHost = stngObj['loadContent'][host]['backHost']
let userName = stngObj['loadContent'][host]['userName']
let repoSite = stngObj['loadContent'][host]['repoSite']
let branch = stngObj['loadContent'][host]['branch']
let dfltDoc = stngObj['loadContent'][host]['dfltDoc']
let urlHome = stngObj['loadContent'][host]['urlHome']
let urlBase = stngObj['loadContent'][host]['urlBase']
if (backHost != '') {
  backHost = '//' + backHost.replace(/\//g, '')
}
if (userName != '') {
  userName = '/' + userName.replace(/\//g, '')
}
if (repoSite != '') {
  repoSite = '/' + repoSite.replace(/\//g, '')
}
if (branch != '') {
  branch = '/' + branch.replace(/\//g, '')
}
let searchArr = []
let searchObj = {}
let url = ''
let q = ''
let dir = ''
let ext = ''
let file = ''
let type = ''
let preview = '0'
let endSwch = 0
let mainContent_novel = `
<main class="novel contents-container">
  <div class="info">
    <p id="area-counter-top">全文：<span id="counter-top"></span>文字</p>
  </div>
  <div id="novel_contents">
    <div id="novel_color">
      <div class="novel_bn">
        <a class="prev">&lt;&lt; 前へ</a>
        <a class="next">次へ &gt;&gt;</a>
      </div>
      <div id="novel_no"></div>
      <p class="novel_subtitle"></p>
      <div id="novel_honbun"></div>
      <div class="novel_bn">
        <a class="prev">&lt;&lt; 前へ</a>
        <a class="next">次へ &gt;&gt;</a>
      </div>
    </div>
  </div>
  <div class="info">
    <p id="area-counter-bottom">全文：<span id="counter-bottom"></span>文字</p>
  </div>
  <div id="area-counter-slctd">
    選択範囲：<span id="counter-slctd"></span>文字
  </div>
</main>
`
let mainContent_etc = `
<main class="markdown html another contents-container"></main>
`
let slctd = 0
let slctdLen = 0
let status = 0
let elm_counterSlctd = 0
let elm_areaCounterSlctd = 0
window.onload = function() {
  setPrm()
  setRtnLink()
}
/*
  1st run
*/
function setPrm() {
  // ex. search = ?q=http://novel.c/op.18/001.txt&type=novel
  if (search === '') {
    url = backHost + userName + repoSite + branch + dfltDoc
    ext = dfltDoc.replace(/.*([^\.]+)$/, '$1')
  } else {
    searchArr = search.split('&')
    for (let i = 0; searchArr.length - 1 >= i; i++) {
      let workArr = searchArr[i].split('=')
      searchObj[workArr[0]] = workArr[1]
    }
    q = searchObj['q']
    type = searchObj['type']
    preview = searchObj['preview']
    if (q === undefined || q === '' || q === '/') {
    // ルートディレクトリ
      dir = '/'
      file = dfltDoc
    } else if (!q.match(/^.+\/$/) === false) {
    // ディレクトリ終わり
      dir  = '/' + q.replace(/^\/?([^\/].*)\/$/, '$1')
      file = '/' + dfltDoc
    } else if (!q.match(/^\/?[^\/]+$/) === false) {
    // ルートディレクトリのファイル終わり
      dir = ''
      file = '/' + q.replace(/^\/?([^\/]+)$/, '$1')
    } else if (!q.match(/^.+?\/[^\/]+$/) === false) {
    // ディレクトリとファイル終わり
      dir = '/' + q.replace(/^\/?([^\/].*?)\/[^\/]+$/, '$1')
      file = '/' + q.replace(/^.*?\/([^\/]+)$/, '$1')
    }
    ext = file.replace(/[^\.]*\.+([^\.])+$/, '')
    url = backHost + userName + repoSite + branch + dir + file
    console.log(url)
  }
  loadContent(url)
}
/*
  2nd run
*/
function loadContent(url) {
  let now = new Date()
  $.ajax({
    url: url + '?' + now,
    cache: false,
  })
  .done(function(data) {
    writeContent(data)
  })
  .fail(function() {
  })
}
/*
  3rd run
*/
function writeContent(data) {
  let pageHeader = document.getElementById('page-header')
  if (type === 'novel' || type === 'nvl') {
    pageHeader.insertAdjacentHTML('afterend', mainContent_novel)
    writeContent_novel(data, 'novel')
  } else if (type === 'plot' || type === 'plt') {
    pageHeader.insertAdjacentHTML('afterend', mainContent_novel)
    writeContent_novel(data, 'plot')
  } else if (type === 'both') {
    pageHeader.insertAdjacentHTML('afterend', mainContent_novel)
    writeContent_novel(data, 'both')
  } else if (type === 'no-ruby') {
    pageHeader.insertAdjacentHTML('afterend', mainContent_novel)
    writeContent_novel(data, 'no-ruby')
  } else if (file === '/README.md') {
    pageHeader.insertAdjacentHTML('afterend', mainContent_etc)
    writeContent_index(data)
  } else {
    if (ext === 'txt') {
      pageHeader.insertAdjacentHTML('afterend', mainContent_etc)
      writeContent_txt(data)
    } else if (ext === 'html') {
      pageHeader.insertAdjacentHTML('afterend', mainContent_etc)
      writeContent_html(data)
    } else if (ext === 'md') {
      pageHeader.insertAdjacentHTML('afterend', mainContent_etc)
      writeContent_md(data)
    } else {
      pageHeader.insertAdjacentHTML('afterend', mainContent_etc)
      writeContent_index(data)
    }
  }
  elm_counterSlctd = document.getElementById('counter-slctd')
  elm_areaCounterSlctd = document.getElementById('area-counter-slctd')
}
function writeContent_novel(dataSrc, type) {
  let data = dataSrc
  let word = ''
  if (type === 'novel' || type === 'no-ruby') {
    word = procEnd(1, procNovel(data))
  } else if (type === 'plot') {
    word = procEnd(1, procPlot(data))
  } else if (type === 'both') {
    word = procEnd(1, procBoth(data))
  }
  let counter = data.replace(/\{plot\}[\s\S]*/g, '')
                    .replace(/^# .*?\n/m, '')
                    .replace(/｜(.*?)《.*?》/g, '$1')
                    .replace(/([\u4E00-\u9FFF]+?)（.*?）/g, '$1')
                    .replace(/｜(（.*?）)/g, '$1')
                    .replace(/( |　|\n)/g, '')
                    .length
                    .toString()
  if (!data.match(/^# /) === false) {
    let subTitl = data.match(/^#\s.*/)[0].replace(/#\s*/, '')
    $('title').empty().append(subTitl)
    $('p.novel_subtitle').append(subTitl)
  }
  $('html').addClass('novel markdown')
  $('div#novel_honbun').append(word)
  let elm_counterTop = document.getElementById('counter-top')
  let elm_counterBottom = document.getElementById('counter-bottom')
  elm_counterTop.textContent = counter
  elm_counterBottom.textContent = counter
  function procNovel(data) {
    let work = ''
    let wordArr = data.replace(/^[#*].*\n/mg, '').split('\n')
    let wordObj = {}
    let wordArrLen = wordArr.length - 1
    for (var i = 0; wordArrLen >= i; i++) {
      wordObj[i] = {}
      if (
        (
          i === 0
          &&
          wordArr[i + 1] !== ''
        )
        ||
        (
          wordArr[i - 1] === ''
          &&
          wordArr[i] !== ''
          &&
          wordArr[i + 1] !== ''
        )
      ) {
        wordObj[i]['word'] = '<p>' + wordArr[i] + '<br>'
      } else if (
        (
          (
            i === 0
            ||
            wordArr[i - 1] === ''
          )
          &&
          wordArr[i + 1] === ''
        )
        ||
        (
          i === wordArrLen - 1
          &&
          wordArr[i - 1] === ''
        )
      ) {
        wordObj[i]['word'] = '<p>' + wordArr[i] + '<\/p>'
      } else if (
        wordArr[i] === ''
      ) {
        wordObj[i]['word'] = '<p><br><\/p>'
      } else if (
        (
          wordArr[i - 1] !== ''
          &&
          wordArr[i] !== ''
          &&
          wordArr[i + 1] === ''
        )
        ||
        (
          i === wordArrLen - 1
          &&
          wordArr[i - 1] !== ''
        )
      ) {
        wordObj[i]['word'] = wordArr[i] + '<\/p>'
      } else if (
        wordArr[i - 1] !== ''
        &&
        wordArr[i] !== ''
        &&
        wordArr[i + 1] !== ''
      ) {
        wordObj[i]['word'] = wordArr[i] + '<br>'
      }
      work = work + wordObj[i]['word']
    }
    if (type === 'novel') {
      work = rubyParse(keywdRpl(work))
      return work
    } else if (type === 'no-ruby') {
      work = rubyRm(keywdRpl(work))
      return work
    }
  }
  function procPlot(data) {
    let work = data.replace(/[\s\S]*\{plot\}.*\n([\s\S]*)/g, '$1')
                   .replace(/^# .*?\n/m, '')
    work = rubyParse(keywdRpl(mdParse(work)))
    return work
  }
  function procBoth(data) {
    let dataNovel = procNovel(data)
    let dataPlot = procPlot(data)
    let hdngNovel = ''
    let hdngPlot = ''
    if (dataNovel.replace(/\s|　|<p>[\s　]*(<\/p>)?/g, '').length != 0) {
      hdngNovel = '<h1>本文<\/h1>\n'
    }
    if (dataPlot.replace(/[\s　]/g, '').length != 0) {
      hdngPlot = '\n<h1>プロット<\/h1>'
    }
    return hdngNovel + dataNovel + hdngPlot + dataPlot
  }
  epsdNumber()
}
function writeContent_index(data) {
  let word = keywdRpl(rubyParse(mdParse(data).replace(/href="(.*?)"/g, 'href="?q=' + dir + '/$1&type=novel"')))
  $('html').addClass('markdown')
  $('.markdown.contents-container').append(word)
  procEnd(1, '')
}
function writeContent_txt(data) {
  $('body').append(data)
  procEnd(1, '')
}
function writeContent_html(data) {
  let word = keywdRpl(data)
  let titl = file.slice(1)
  $('html').addClass('html')
  $('.html.contents-container').append(word)
  $('title').empty().append(decodeURI(titl))
  $('.title').append(decodeURI(titl))
  procEnd(1, '')
}
function writeContent_md(data) {
  let word = keywdRpl(rubyParse(mdParse(data)))
  $('html').addClass('markdown')
  $('.markdown.contents-container').append(word)
  procEnd(1, '')
}
function writeContent_another(data) {
  $('.another.contents-container').append(data)
  procEnd(1, '')
}
function rubyParse(data) {
  let word = data.replace(/｜([^｜]*?)《(.*?)》/g, '<ruby>$1<rt>$2</rt></ruby>')
                 .replace(/([\u4E00-\u9FFF]+)（(.*?)）/g, '<ruby>$1<rt>$2</rt></ruby>')
                 .replace(/｜(（.*?）)/g, '$1')
  return word
}
function rubyRm(data) {
  let word = data.replace(/｜(.*?)《(.*?)》/g, '$1')
                 .replace(/([\u4E00-\u9FFF]+)（(.*?)）/g, '$1')
                 .replace(/｜(（.*?）)/g, '$1')
  return word
}
function keywdRpl(data) {
  let wordListRpl = [
    ["\{setup\}", '<span class="capsule-part">設定パート</span>'],
    ["\{inciting incident\}", "{切っ掛け}"],
    ["\{central question\}", "{ストーリーの問い掛け}"],
    ["\{plot point 1\}", "{転換点 1}"],
    ["\{plot point 2\}", "{転換点 2}"],
    ["\{conflict\}", '<span class="capsule-part">対立パート</span>'],
    ["\{favorable\}", '<span class="capsule-part">好調パート</span>'],
    ["\{unfavorable\}", '<span class="capsule-part">苦境パート</span>'],
    ["\{midd point\}", "{中間点}"],
    ["\{resolution\}", '<span class="capsule-part">解決パート</span>'],
    ["\{ending\}", "{エンディングシーン}"],
    ["\{", '<span class="capsule">'],
    ["\}", '</span>'],
    ["objective", "目的"],
    ["story", "ストーリー"],
    ["plot", "プロット"],
    ["overview", "概要"],
    ["detailes", "詳細"],
    ["act", "幕"],
    ["sequence", "シーケンス"],
    ["scene", "シーン"],
    ["unit", "ユニット"],
    ["title", "タイトル"],
    ["view of the world", "世界観"],
    ["concept", "コンセプト"],
    ["theme", "テーマ"],
    ["medium", "提示方法"],
    ["chapter", "章"],
    ["design bullets", "設計"],
    ["elements", "設計要素"],
    ["bullets", "箇条書き"]
  ]
  let wordListHide = ["_summary_", "_gist_"]
  let work = data
  for (let i = 0; wordListRpl.length - 1 >= i; i++) {
    work = work.replace(new RegExp(wordListRpl[i][0], 'g'), wordListRpl[i][1])
  }
  for (let i = 0; wordListHide.length - 1 >= i; i++) {
    work = work.replace(new RegExp(wordListHide[i], 'g'), '<span class="hide">' + wordListHide[i] + '</span>')
  }
  return work
}
function setRtnLink() {
  if (file === '/README.md') {
    ppndAnch(urlHome, '小説関連に戻る')
  } else {
    ppndAnch('?q=' + dir + '/README.md&type=index', '目次ページに戻る')
  }
}
function ppndAnch(target, label) {
  $('.page-footer').prepend('<a class="return-link" href="' + target + '">' + label + '</a>')
}
function epsdNumber(epsdNumber) {
  $.ajax({
    url: backHost + userName + dir + branch + '/README.md',
    dataType: 'text',
  })
  .done(function(data) {
    let work = data
    let titl = ''
    if (!work.match(/# .*/) === false) {
      titl = work.match(/# .*/)[0].replace(/^# (.*)$/, '$1')
      $('.info').prepend('<p class="title">' + titl + '</p>')
    }
    let epsdArr = []
    epsdArr = work.replace(/[\s\S]*?(## 本文.*?\n)((.*?\n)*?)\n[\s\S]*/g, '$2')
                 .replace(/[ \t]*(\*|\+|-|\d+\.) .*?\[.*?\]\([ \t]*(.*?)[ \t]*\).*/g, '$2')
                 .split('\n')
                 .slice(0, -1)
    let epsdObj = {}
    let epsdArrLen = epsdArr.length 
    for (let i = epsdArrLen - 1; i >= 0; i--) {
      epsdObj[Number(epsdArr[i].replace(/^.*?(\d{3}).*?$/m, '$1'))] = [epsdArr[i].replace(/^(.*?)\d{3}.*?$/m, '$1'), epsdArr[i].replace(/^.*?\d{3}(.*?)$/m, '$1')]
    }
    let epsdCrr = Number(file.replace(/^.*?(\d{3}).*?$/m, '$1'))
    if (epsdObj[epsdCrr - 1]) {
      $('a.prev').attr('href', '?q=' + dir + '/' + epsdObj[epsdCrr - 1][0] + ('000' + (epsdCrr - 1)).slice(-3) + epsdObj[epsdCrr - 1][1] + '&type=' + type + '&preview=' + preview)
      $('a.prev').css('display', 'initial')
    }
    if (epsdObj[epsdCrr + 1]) {
      $('a.next').attr('href', '?q=' + dir + '/' + epsdObj[epsdCrr + 1][0] + ('000' + (epsdCrr + 1)).slice(-3) + epsdObj[epsdCrr + 1][1] + '&type=' + type + '&preview=' + preview)
      $('a.next').css('display', 'initial')
    }
    $('div#novel_no').append(epsdCrr + '/' + epsdArrLen)
  })
  .fail(function() {
    console.log("error")
  })
  .always(function() {
    setHeit()
  })
}
function procEnd(incr, data) {
  endSwch = endSwch + incr
  if (endSwch >= 1) {
    setTimeout(function() {
      if (preview === '1') {
        scrollTo(0, scrlHeit + 100)
      }
    }, 800)
  }
  return data
}
{
  function procCounter(e) {
    let timeout = window.setTimeout(count, 100)
    function count() {
      slctd = document.getSelection()
      if (slctd.isCollapsed === false) {
        slctdLen = slctd
                   .getRangeAt(0)
                   .toString()
                   .replace(/｜(.*?)《.*?》/g, '$1')
                   .replace(/([\u4E00-\u9FFF]+?)（.*?）/g, '$1')
                   .replace(/｜(（.*?）)/g, '$1')
                   .replace(/( |　|\n)/g, '')
                   .length
        elm_counterSlctd.textContent = slctdLen
        elm_areaCounterSlctd.classList.add('selected')
      } else {
        elm_areaCounterSlctd.classList.remove('selected')
      }
      clearTimeout(timeout)
    }
  }
  window.addEventListener('mouseup', function(e) {
    procCounter(e)
  })
  window.addEventListener('touched', function(e) {
    procCounter(e)
  })
}
</script>
<header id="page-header" class="page-header">
  <a href="/">
    <img src="/images/satsuki-thyme-fg-green-bg-trn.svg" alt="Satsuki Thyme">
    <h1>作品閲覧ページ</h1>
  </a>
</header>



<footer class="page-footer">
  <nav>
    <ul>
      <li><a href="/">トップページ</a></li>
      <li><a href="/profile.html">プロフィール</a></li>
      <li><a href="/favorite.html">好きなもの</a></li>
      <li><a href="/novel.html">小説関連</a></li>
      <li><a class="current" href="/view-opus.html">作品閲覧ページ</a></li>
      <li><a href="/blog/diary/">日記</a></li>
      <li><a href="/distribution.html">配布データ</a></li>
      <li><a href="https://twitter.com/SatsukiThyme" title="Twitter">@SatsukiThyme</a></li>
    </ul>
  </nav>
  <p class="privacy-policy"><a href="/privacy-policy.htnl">プライバシーポリシー</a></p>  
  <p class="copywrite">&copy;Satsuki Thyme</p>  
</footer>
<div class="down">
  <button>▼</button>
</div>
<div class="up">
  <button>▲</button>
</div>
<div class="reload">
  <button></button>
</div>
</html>
