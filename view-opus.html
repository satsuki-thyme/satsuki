<html lang="ja" class="view-opus sub-page load-contents">
<title>作品閲覧ページ</title>
<meta charset="utf-8">
<meta name="keywords" content="五月タイム, 小説, ネット小説, ライトノベル, ラノベ">
<meta name="description" content="ネット小説を主に執筆している小説執筆活動家「五月タイム」の作品閲覧ページです。">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:url" content="https://satsuki-thyme.com/view-opus.html">
<meta property="og:title" content="作品閲覧ページ">
<meta property="og:description" content="ネット小説を主に執筆している小説執筆活動家「五月タイム」の作品閲覧ページです。">
<meta property="og:image" content="https://satsuki-thyme.com/images/satsuki-thyme-fg-white-bg-green-1200x630.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:site_name" content="五月タイムのサイト">
<meta property="og:type" content="webpage">
<meta property="og:locale" content="ja_JP">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@camellia">
<meta name="twitter:site" content="@satsuki_thyme">
<meta name="twitter:image:src" content="https://satsuki-thyme.com/images/thyme-fg-white-bg-green-512s.png">
<meta property="article:publisher" content="https://www.facebook.com/satsuki.thyme">
<meta property="fb:admins" content="satsuki.thyme">
<meta name="application-name" content="Satsuki Thyme">
<meta name="msapplication-square70x70logo" content="https://satsuki-thyme.com/images/thyme-fg-white-bg-green-70s.png">
<meta name="msapplication-square150x150logo" content="https://satsuki-thyme.com/images/thyme-fg-white-bg-green-150s.png">
<meta name="msapplication-wide310x150logo" content="https://satsuki-thyme.com/images/thyme-fg-white-bg-green-310x150.png">
<meta name="msapplication-square310x310logo" content="https://satsuki-thyme.com/images/thyme-fg-white-bg-green-310s.png">
<meta name="msapplication-TileColor" content="#62a433">
<link rel="icon" href="https://satsuki-thyme.com/favicon.ico">
<link rel="apple-touch-icon" sizes="180x180" href="https://satsuki-thyme.com/images/thyme-fg-white-bg-green-180s.png">
<link href="/default.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="/mdparse.js"></script>
<script src="/default.js"></script>
<script>
let srch = location.search.slice(1)
let host = location.hostname
let stngObj = {
  "loadCnt": {
    "satsuki-thyme.com": {
      "backHost": "raw.githubusercontent.com",
      "userName": "satsuki-thyme",
      "repoSite": "satsuki-thyme.github.io",
      "brch": "master",
      "dfltDoc": "README.md",
      "urlHome": "/novel.html",
      "urlBase": "/view-opus.html"
    },
    "satsuki-thyme.c": {
      "backHost": "novel.c",
      "userName": "",
      "repoSite": "",
      "brch": "",
      "dfltDoc": "README.md",
      "urlHome": "/novel.html",
      "urlBase": "/view-opus.html"
    },
    "novel.c": {
      "backHost": "novel.c",
      "userName": "",
      "repoSite": "",
      "brch": "",
      "dfltDoc": "README.md",
      "urlHome": "?README.md",
      "urlBase": "/view-opus.html"
    }
  }
}
let backHost = stngObj['loadCnt'][host]['backHost']
let userName = stngObj['loadCnt'][host]['userName']
let repoSite = stngObj['loadCnt'][host]['repoSite']
let brch = stngObj['loadCnt'][host]['brch']
let dfltDoc = stngObj['loadCnt'][host]['dfltDoc']
let urlHome = stngObj['loadCnt'][host]['urlHome']
let urlBase = stngObj['loadCnt'][host]['urlBase']
if (backHost != '') {
  backHost = '//' + backHost.replace(/\//g, '')
}
if (userName != '') {
  userName = '/' + userName.replace(/\//g, '')
}
if (repoSite != '') {
  repoSite = '/' + repoSite.replace(/\//g, '')
}
if (brch != '') {
  brch = '/' + brch.replace(/\//g, '')
}
let srchArr = []
let srchObj = {}
let url = ''
let q = ''
let dir = ''
let ext = ''
let file = ''
let type = ''
let preview = ''
let endSwch = 0
let mainCnt_nvl = `
<main class="novel contents-container">
  <div class="info"></div>
  <div id="novel_contents">
    <div id="novel_color">
      <div class="novel_bn">
        <a class="prev">&lt;&lt; 前へ</a>
        <a class="next">次へ &gt;&gt;</a>
      </div>
      <div id="novel_no"></div>
      <p class="novel_subtitle"></p>
      <div id="novel_honbun"></div>
      <div class="novel_bn">
        <a class="prev">&lt;&lt; 前へ</a>
        <a class="next">次へ &gt;&gt;</a>
      </div>
    </div>
  </div>
  <div class="selected-len"></div>
</main>
`
let mainCnt_etc = `
<main class="markdown html another contents-container"></main>
`
window.onload = function() {
  setPrm()
  setRtnLink()
}
/*
  1st run
*/
function setPrm() {
  // ex. srch = ?q=http://novel.c/op.18/001.txt&type=novel
  if (srch === '') {
    url = backHost + userName + repoSite + brch + dfltDoc
    ext = dfltDoc.replace(/.*([^\.]+)$/, '$1')
  } else {
    srchArr = srch.split('&')
    for (let i = 0; srchArr.length - 1 >= i; i++) {
      let workArr = srchArr[i].split('=')
      srchObj[workArr[0]] = workArr[1]
    }
    q = srchObj['q']
    type = srchObj['type']
    preview = srchObj['preview']
    if (q === undefined || q === '' || q === '/') {
    // ルートディレクトリ
      dir = '/'
      file = dfltDoc
    } else if (!q.match(/^.+\/$/) === false) {
    // ディレクトリ終わり
      dir  = '/' + q.replace(/^\/?([^\/].*)\/$/, '$1')
      file = '/' + dfltDoc
    } else if (!q.match(/^\/?[^\/]+$/) === false) {
    // ルートディレクトリのファイル終わり
      dir = ''
      file = '/' + q.replace(/^\/?([^\/]+)$/, '$1')
    } else if (!q.match(/^.+?\/[^\/]+$/) === false) {
    // ディレクトリとファイル終わり
      dir = '/' + q.replace(/^\/?([^\/].*?)\/[^\/]+$/, '$1')
      file = '/' + q.replace(/^.*?\/([^\/]+)$/, '$1')
    }
    ext = file.replace(/[^\.]*\.+([^\.])+$/, '')
    url = backHost + userName + dir + brch + file
  }
  loadCnt(url)
}
/*
  2nd run
*/
function loadCnt(url) {
  let now = new Date()
  $.ajax({
    url: url + '?' + now,
    cache: false,
  })
  .done(function(data) {
    wrtCnt(data)
  })
  .fail(function() {
  })
}
/*
  3rd run
*/
function wrtCnt(data) {
  if (type === 'novel' || type === 'nvl') {
    $('header').after(mainCnt_nvl)
    wrtCnt_nvl(data, 'novel')
  } else if (type === 'plot' || type === 'plt') {
    $('header').after(mainCnt_nvl)
    wrtCnt_nvl(data, 'plot')
  } else if (type === 'both') {
    $('header').after(mainCnt_nvl)
    wrtCnt_nvl(data, 'both')
  } else if (file === '/README.md') {
    $('header').after(mainCnt_etc)
    wrtCnt_indx(data)
  } else {
    if (ext === 'txt') {
      $('header').after(mainCnt_etc)
      wrtCnt_txt(data)
    } else if (ext === 'html') {
      $('header').after(mainCnt_etc)
      wrtCnt_html(data)
    } else if (ext === 'md') {
      $('header').after(mainCnt_etc)
      wrtCnt_md(data)
    } else {
      $('header').after(mainCnt_etc)
      wrtCnt_indx(data)
    }
  }
  $('html, body').animate({scrollTop: scrlHeit + 100}, 'fast')
}
function wrtCnt_nvl(data, type) {
  let word = ''
  if (type === 'novel') {
    word = procEnd(1, procNvl(data))
  } else if (type === 'plot') {
    word = procEnd(1, procPlot(data))
  } else if (type === 'both') {
    word = procEnd(1, procBoth(data))
  }
  let wordLen = data.replace(/\{plot\}[\s\S]*/g, '')
                    .replace(/^# .*?\n/m, '')
                    .replace(/｜(.*?)《.*?》/g, '$1')
                    .replace(/([\u4E00-\u9FFF]+?)（.*?）/g, '$1')
                    .replace(/｜(（.*?）)/g, '$1')
                    .replace(/( |　|\n)/g, '')
                    .length
  if (!data.match(/^# /) === false) {
    let subTitl = data.match(/^#\s.*/)[0].replace(/#\s*/, '')
    $('title').empty().append(subTitl)
    $('p.novel_subtitle').append(subTitl)
  }
  $('html').addClass('novel markdown')
  $('div#novel_honbun').append(word)
  $('.info').append('<p class="number">文字数：' + wordLen + '文字</p>')
  function procNvl(data) {
    let work = data.replace(/\{plot\}[\s\S]*/g, '')
                   .replace(/^# .*$/m, '')
                   .replace(/^(.*)$/gm, '<p>$1<\/p>')
    work = rubyParse(keywdRpl(work))
    return work
  }
  function procPlot(data) {
    let work = data.replace(/[\s\S]*\{plot\}.*\n([\s\S]*)/g, '$1')
    work = rubyParse(keywdRpl(mdParse(work)))
    return work
  }
  function procBoth(data) {
    let dataNvl = procNvl(data)
    let dataPlot = procPlot(data)
    let hdngNvl = ''
    let hdngPlot = ''
    if (dataNvl.replace(/\s|　|<p>[\s　]*(<\/p>)?/g, '').length != 0) {
console.log(dataNvl.replace(/\s|　|<p>[\s　]*(<\/p>)?/g, ''))
      hdngNvl = '<h1>本文<\/h1>\n'
    }
    if (dataPlot.replace(/[\s　]/g, '').length != 0) {
      hdngPlot = '\n<h1>プロット<\/h1>'
    }
    return hdngNvl + dataNvl + hdngPlot + dataPlot
  }
  epsNmb()
}
function wrtCnt_indx(data) {
  let word = keywdRpl(rubyParse(mdParse(data).replace(/href="(.*?)"/g, 'href="?q=' + dir + '/$1&type=novel"')))
  $('html').addClass('markdown')
  $('.markdown.contents-container').append(word)
  procEnd(1, '')
}
function wrtCnt_txt(data) {
  let word = data
  $('body').append(word)
  procEnd(1, '')
}
function wrtCnt_html(data) {
  let word = keywdRpl(data)
  let titl = file.slice(1)
  $('html').addClass('html')
  $('.html.contents-container').append(word)
  $('title').empty().append(decodeURI(titl))
  $('.title').append(decodeURI(titl))
  procEnd(1, '')
}
function wrtCnt_md(data) {
  let word = keywdRpl(rubyParse(mdParse(data)))
  $('html').addClass('markdown')
  $('.markdown.contents-container').append(word)
  procEnd(1, '')
}
function wrtCnt_another(data) {
  $('.another.contents-container').append(data)
  procEnd(1, '')
}
function rubyParse(data) {
  let word = data.replace(/｜(.*?)《(.*?)》/g, '<ruby>$1<rt>$2</rt></ruby>')
                 .replace(/([\u4E00-\u9FFF]+?)（(.*?)）/g, '<ruby>$1<rt>$2</rt></ruby>')
                 .replace(/｜(（.*?）)/g, '$1')
  return word
}
function keywdRpl(data) {
  let wordListRpl = [
    ["\{setup\}", '<span class="capsule-part">設定パート</span>'],
    ["\{inciting incident\}", "{切っ掛け}"],
    ["\{central question\}", "{ストーリーの問い掛け}"],
    ["\{plot point 1\}", "{転換点 1}"],
    ["\{plot point 2\}", "{転換点 2}"],
    ["\{conflict\}", '<span class="capsule-part">対立パート</span>'],
    ["\{favorable\}", '<span class="capsule-part">好調パート</span>'],
    ["\{unfavorable\}", '<span class="capsule-part">苦境パート</span>'],
    ["\{midd point\}", "{中間点}"],
    ["\{resolution\}", '<span class="capsule-part">解決パート</span>'],
    ["\{ending\}", "{エンディングシーン}"],
    ["\{", '<span class="capsule">'],
    ["\}", '</span>']
  ]
  let wordListHide = ["_summary_", "_gist_"]
  let work = data
  for (let i = 0; wordListRpl.length - 1 >= i; i++) {
    work = work.replace(new RegExp(wordListRpl[i][0], 'g'), wordListRpl[i][1])
  }
  for (let i = 0; wordListHide.length - 1 >= i; i++) {
    work = work.replace(new RegExp(wordListHide[i], 'g'), '<span class="hide">' + wordListHide[i] + '</span>')
  }
  return work
}
function setRtnLink() {
  if (file === '/README.md') {
    ppndAnch(urlHome, '小説関連に戻る')
  } else {
    ppndAnch('?q=' + dir + '/README.md&type=index', '目次ページに戻る')
  }
}
function ppndAnch(target, label) {
  $('.page-footer').prepend('<a class="return-link" href="' + target + '">' + label + '</a>')
}
function epsNmb(epsNmb) {
  $.ajax({
    url: backHost + userName + dir + brch + '/README.md',
    dataType: 'text',
  })
  .done(function(data) {
    let titl = ''
    if (!data.match(/# .*/) === false) {
      titl = data.match(/# .*/)[0].replace(/^# (.*)$/, '$1')
      $('.info').prepend('<p class="title">' + titl + '</p>')
    }
    let epsArr = data.replace(/^[\s\S]*?# 本文[\s\S]*?((\*|\+|-|\d+\.) [\s\S]*?)(\n\n|\n$|$)/g, '$1')
                     .replace(/^[ \t]*(\*|\+|-|\d+\.) .*?\[.*?\]\([ \t]*?(.*?)[ \t]*\).*$/gm, '$2')
                     .split('\n')
    let epsObj = {}
    let epsArrLen = epsArr.length 
    for (let i = epsArrLen - 1; i >= 0; i--) {
      epsObj[Number(epsArr[i].replace(/^.*?(\d{3}).*?$/m, '$1'))] = [epsArr[i].replace(/^(.*?)\d{3}.*?$/m, '$1'), epsArr[i].replace(/^.*?\d{3}(.*?)$/m, '$1')]
    }
    let epsCrr = Number(file.replace(/^.*?(\d{3}).*?$/m, '$1'))
    if (epsObj[epsCrr - 1]) {
      $('a.prev').attr('href', '?q=' + dir + '/' + epsObj[epsCrr - 1][0] + ('000' + (epsCrr - 1)).slice(-3) + epsObj[epsCrr - 1][1] + '&type=' + type + '&preview=' + preview)
      $('a.prev').css('display', 'initial')
    }
    if (epsObj[epsCrr + 1]) {
      $('a.next').attr('href', '?q=' + dir + '/' + epsObj[epsCrr + 1][0] + ('000' + (epsCrr + 1)).slice(-3) + epsObj[epsCrr + 1][1] + '&type=' + type + '&preview=' + preview)
      $('a.next').css('display', 'initial')
    }
    $('div#novel_no').append(epsCrr + '/' + epsArrLen)
  })
  .fail(function() {
    console.log("error")
  })
  .always(function() {
    setHeit()
  })
}
function procEnd(incr, data) {
  endSwch = endSwch + incr
  if (endSwch >= 1) {
    setTimeout(function() {
      if (preview === '1') {
        scrollTo(0, scrlHeit + 100)
      }
    }, 800)
  }
  return data
}
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-96637203-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-96637203-1');
</script>
<header class="page-header">
  <a href="/">
    <img src="/images/satsuki-thyme-fg-green-bg-trn.svg" alt="Satsuki Thyme">
    <h1>作品閲覧ページ</h1>
  </a>
</header>



<footer class="page-footer">
  <nav>
    <ul>
      <li><a href="/">トップページ</a></li>
      <li><a href="/profile.html">プロフィール</a></li>
      <li><a href="/favorite.html">好きなもの</a></li>
      <li><a href="/novel.html">小説関連</a></li>
      <li><a class="current" href="/view-opus.html">作品閲覧ページ</a></li>
      <li><a href="/blog/diary/">日記</a></li>
      <li><a href="/distribution.html">配布データ</a></li>
      <li><a href="https://twitter.com/camellia" title="Twitter">@camellia</a></li>
    </ul>
  </nav>
  <p class="privacy-policy"><a href="/privacy-policy.htnl">プライバシーポリシー</a></p>  
  <p class="copywrite">&copy;Satsuki Thyme</p>  
</footer>
<div class="down">
  <button>▼</button>
</div>
<div class="up">
  <button>▲</button>
</div>
<div class="reload">
  <button></button>
</div>
</html>
